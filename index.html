<html>
<head>
  <meta charset="utf-8">
  <script src="https://js.braintreegateway.com/web/dropin/1.9.4/js/dropin.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="dropin-container"></div>
  <button id="submit-button">Submit</button>
  <script>


  var button = document.querySelector('#submit-button');

//
// $.ajax({
//   type: 'GET',
//   dataType : 'jsonp',
//   url: 'https://pumpkin-centipede-6684.twil.io/client_token?callback=?',
//   success: function(res) {
//     console.log(res);
//     var client_token = res.clientToken;
//   }
// })

braintree.dropin.create(
  {
    authorization: 'sandbox_85t45z6g_3vnk2zsw8dmhkfkf',
    container: '#dropin-container'
  },
  function(createErr, instance) {
    button.addEventListener('click', function() {
      instance.requestPaymentMethod(function(err, payload) {
        // Submit payload.nonce to your server
        $.ajax({
          type: 'POST',
          url: 'https://pumpkin-centipede-6684.twil.io/checkout',
          data: {'paymentMethodNonce': payload.nonce}
        }).done(function(result) {
          // Tear down the Drop-in UI
          instance.teardown(function (teardownErr) {
            if (teardownErr) {
              console.error('Could not tear down Drop-in UI!');
            } else {
              console.info('Drop-in UI has been torn down!');
              // Remove the 'Submit payment' button
              $('#submit-button').remove();
            }
          });

          if (result.success) {
            $('#checkout-message').html('<h1>Success</h1><p>Your Drop-in UI is working! Check your <a href="https://sandbox.braintreegateway.com/login">sandbox Control Panel</a> for your test transactions.</p><p>Refresh to try another transaction.</p>');
          } else {
            console.log(result);
            $('#checkout-message').html('<h1>Error</h1><p>Check your console.</p>');
          }
      });
    });
  });
});
</script>
</body>
</html>
